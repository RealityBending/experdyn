% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/resample_timeseries.R
\name{resample_timeseries}
\alias{resample_timeseries}
\title{Resample and Interpolate Irregularly Sampled ESM Time Series}
\usage{
resample_timeseries(
  data,
  time_col = "time",
  participant_col = NULL,
  max_gap = 6,
  target_frequency = 60,
  interpolation_method = "spline",
  min_points = 4,
  verbose = TRUE,
  plot = TRUE,
  plot_offset = FALSE
)
}
\arguments{
\item{data}{A data frame containing at minimum:
\itemize{
\item a timestamp column (identified by \code{time_col});
\item one or more \strong{numeric variable columns} — all numeric columns other
than \code{time_col} and \code{participant_col} are treated as variables to
interpolate (no specific naming convention is required);
\item optionally, a participant identifier column (identified by \code{participant_col}).
}}

\item{time_col}{\verb{[character(1): "time"]}\cr
Name of the column in \code{data} that contains the timestamps. Values must be
coercible to \code{POSIXct}.}

\item{participant_col}{\verb{[character(1) or NULL: NULL]}\cr
Name of the column in \code{data} that identifies participants. If \code{NULL}
(default), all observations are treated as coming from a single participant
labelled \code{"All"}.}

\item{max_gap}{\verb{[numeric(1): 6]}\cr
Maximum allowable gap \strong{in hours} between two consecutive observations
before a new subseries is started. Gaps larger than this value (e.g.,
overnight breaks between daily bursts of notifications) mark a boundary
between subseries.}

\item{target_frequency}{\verb{[numeric(1): 60]}\cr
Desired spacing \strong{in minutes} between consecutive observations on the
regular output grid. For example, \code{target_frequency = 60} produces one
observation per hour; \code{target_frequency = 30} produces one every 30 minutes.}

\item{interpolation_method}{\verb{[character(1): "spline"]}\cr
Interpolation method to use. Either \code{"spline"} (natural cubic spline via
\code{\link[stats:splinefun]{stats::spline()}}) or \code{"linear"} (piecewise linear via \code{\link[stats:approxfun]{stats::approx()}}).
Both methods operate strictly within the range of valid (non-\code{NA})
observations — no extrapolation is performed beyond the data.}

\item{min_points}{\verb{[integer(1): 4]}\cr
Minimum number of valid (non-\code{NA}) observations required within a
subseries to attempt interpolation. Subseries with fewer points are
silently dropped from the output.}

\item{verbose}{\verb{[logical(1): TRUE]}\cr
If \code{TRUE}, prints a short processing summary to the console.}

\item{plot}{\verb{[logical(1): TRUE]}\cr
If \code{TRUE}, a \code{\link[ggplot2:ggplot]{ggplot2::ggplot()}} object is built showing the interpolated
time series (lines) overlaid with the original raw observations (crosses).
Participants are distinguished by colour; multiple variables
are shown in separate facets. The plot is stored as \verb{$plot} in the returned
object.}

\item{plot_offset}{\verb{[logical(1): FALSE]}\cr
If \code{TRUE}, each subseries is shifted so that its x-axis starts at 0 (hours
elapsed since the beginning of that subseries). This makes subseries and
participants directly comparable regardless of their absolute timestamps.}
}
\value{
An object of class \code{experdyn_resampled} — a named list with:\tabular{ll}{
   Element \tab Description \cr
   \code{resampled} \tab Data frame of interpolated observations (see below). \cr
   \code{plot} \tab A \code{ggplot} object (or \code{NULL} if \code{plot = FALSE}). \cr
   \code{interpolation_method} \tab Interpolation method used (\code{"spline"} or \code{"linear"}). \cr
   \code{target_frequency} \tab Requested spacing in minutes between observations. \cr
   \code{sampling_rate} \tab Achieved rate in observations per hour (\code{60 / target_frequency}). \cr
   \code{max_gap} \tab Gap threshold in hours used for subseries detection. \cr
   \code{n_participants} \tab Number of unique participants in the output. \cr
   \code{n_subseries} \tab Total number of usable subseries. \cr
   \code{n_points_raw} \tab Number of rows in the input \code{data}. \cr
   \code{n_points_resampled} \tab Number of rows in \code{resampled}. \cr
   \code{avg_points_per_participant} \tab Mean resampled observations per participant. \cr
}


The \code{resampled} data frame contains:\tabular{ll}{
   Column \tab Description \cr
   \code{ID} \tab Participant identifier. \cr
   \code{Series_ID} \tab Subseries label \code{"<ID>_<n>"}. \cr
   \code{time} \tab Regular grid timestamps (\code{POSIXct}). \cr
   \verb{<variable columns>} \tab Interpolated values, one column per numeric input variable. \cr
}


Use \code{print()} for a human-readable summary, or access \verb{$resampled} for
the underlying data frame.
}
\description{
Converts irregularly spaced time series data — typical of Experience Sampling
Method (ESM) / Ecological Momentary Assessment (EMA) studies — to a \strong{regular
time grid} using natural cubic spline interpolation.

The function automatically detects large temporal gaps in the signal and
splits the data into contiguous \strong{subseries} before interpolating, so that
artefacts are not introduced across overnight breaks or missing assessment
periods.
}
\details{
\subsection{Processing pipeline}{

\strong{Step 1 — Gap detection.}
For each participant, consecutive observations are compared. A new subseries
is started whenever the gap exceeds \code{max_gap} (in hours). The subseries index is
stored in \code{Series_ID}.

\strong{Step 2 — Spline interpolation.}
Within each qualifying subseries (at least \code{min_points} observations), each
variable column is interpolated on a regular grid spaced at
\code{target_frequency} minutes using the chosen \code{interpolation_method}
(natural cubic spline or piecewise linear). Interpolation is strictly
bounded to the range of valid observations — no extrapolation is performed.
Grid points that fall outside this range, or where too many raw values are
\code{NA}, are silently dropped.

\strong{Step 3 — Summary report.}
When \code{verbose = TRUE}, a brief table is printed showing the number of raw
observations, interpolated observations, usable subseries, and the output
sampling rate.
}

\subsection{Why natural cubic splines?}{

Natural splines minimise the integrated squared second derivative subject to
the constraint of passing through the data, which produces smooth
interpolants without oscillatory artefacts at the boundaries. They are a
standard choice for resampling physiological and psychological signals.
}
}
\examples{
# -----------------------------------------------------------------------
# Minimal synthetic ESM dataset
# Two participants, 15 irregular observations each, two variables
# -----------------------------------------------------------------------
set.seed(42)
n <- 15

# Irregular timestamps: gaps of 1, 1.5, 2, or 3 hours chosen at random
t_p1 <- as.POSIXct("2025-01-01 09:00:00") +
  cumsum(sample(60 * c(60, 90, 120, 180), n, replace = TRUE))
t_p2 <- as.POSIXct("2025-01-05 09:00:00") +
  cumsum(sample(60 * c(60, 90, 120, 180), n, replace = TRUE))

esm_data <- data.frame(
  Participant = c(rep("P01", n), rep("P02", n)),
  timestamp   = c(t_p1, t_p2),
  valence    = rnorm(2 * n),
  arousal    = rnorm(2 * n)
)

# Resample to a regular 60-minute grid — all numeric columns are used
result <- resample_timeseries(
  esm_data,
  time_col             = "timestamp",
  participant_col      = "Participant",
  target_frequency     = 60,
  verbose              = TRUE
)
result
head(result$resampled)

# -----------------------------------------------------------------------
# Single-participant usage (participant_col = NULL)
# -----------------------------------------------------------------------
single <- data.frame(
  timestamp   = t_p1,
  valence     = rnorm(n)
)
result_single <- resample_timeseries(
  single,
  time_col            = "timestamp",
  target_frequency    = 30,
  verbose             = FALSE
)

# -----------------------------------------------------------------------
# Stricter gap threshold: split on gaps > 4 hours
# -----------------------------------------------------------------------
resampled_strict <- resample_timeseries(
  esm_data,
  time_col            = "timestamp",
  participant_col     = "Participant",
  max_gap             = 4,
  target_frequency    = 30,
  verbose             = FALSE
)
# Note: more (shorter) subseries are detected
length(unique(resampled_strict$resampled$Series_ID))

# -----------------------------------------------------------------------
# Arbitrary column names — no "Component_" prefix required
# -----------------------------------------------------------------------
esm_custom <- data.frame(
  id        = c(rep("P01", n), rep("P02", n)),
  ts        = c(t_p1, t_p2),
  stress    = rnorm(2 * n),
  energy    = rnorm(2 * n)
)
result_custom <- resample_timeseries(
  esm_custom,
  time_col        = "ts",
  participant_col = "id",
  verbose         = FALSE
)

}
\seealso{
\itemize{
\item \code{\link[stats:splinefun]{stats::spline()}} for the underlying interpolation function.
\item The \code{nonlinearTseries} package for downstream complexity analyses.
}
}
